## 调试课笔记

### 一些调试的删除、撤销、重做

在 devtools 中修改了节点、CSS完全可以恢复回去, ctrl + z 撤销修改; 

甚至可以 ctrl + shift + z redo
ctrl + z 

配合 delete 在查找页面中哪个元素除了问题时非常方便。

### 在Styles Panel中，按住 ctrl, hover 到 属性 属性值 选择器 会有下划线, 点击可以跳到对应行


### 高亮显示重绘元素：

开发者工具条右上角关闭按钮左侧的三个点的按钮——》more tools——》rendering——》勾选painting flashing

影响页面重绘的因素:

（1）页面滚动

（2）交互操作

- dom节点改变
- 动画
- hover, active, focus 等
- 调整窗口大小
- 内容变化
- 计算offsetWidth, offsetHeight
- 新增或修改样式属性

尽量减少重绘提升页面性能, 同时避免组合式重绘。 例如滚动时, 触发页面hover, 轮播滚动等。建议在滚动结束后再启用。

### 显示FPS监测器：

开发者工具条右上角关闭按钮左侧的三个点的按钮——》more tools——》rendering——》勾选Show FPS meter

如果希望创建流畅的体验和交互, 页面渲染应该在每秒60帧以上(即60FPS以上)。

根据FPS的定义: 1000 ms / 60 Hz = 16.6 ms。 记住这一指标: 每一帧的渲染时间应该保持在16ms以下.

### 模拟网络状态（以测试不同网络状态下的加载速度）：

network面板——》切换no throtting选项为任意一种你所需要的网络状态类型

### 去除本地缓存

开发者工具条右上角关闭按钮左侧的三个点的按钮——》settins选项中：

勾选“Disable cache (while DevTools is open)”

当开启控制台时禁用缓存。

在开发时经常会遇到在修改了代码之后, 页面刷新并没有即刻生效.这主要是浏览器缓存的问题, 开启 Disable cache (while DevTools is open) 后, 在打开控制台时每次刷新页面都会重新请求, 忽略本地缓存。

### 模拟不支持JavaScript的情况（将显示`<noscript></noscript>`中指定的内容）

开发者工具条右上角关闭按钮左侧的三个点的按钮——》settins选项中：

勾选“Disable JavaScript”

将禁用 JavaScript。

### 关于开发者工具的那些常用快捷键

command + option + j 用来切换打开和关闭开发者工具条面板


Element Panel:

|快捷键|功能|
| ------| ------ |
|上下箭头| 用于向上和向下切换HTML元素|
|左右箭头| 用于展开和折叠当前HTML元素|
|回车按钮| 编辑当前元素的属性，默认是编辑第一个，按tab键可逐一切换至下一个属性，按shift+tab键会逐一切换至上一个属性|
|h键    | 用于将当前选中的元素在界面上隐藏。反复按该键可以切换隐藏和显示状态, 实际上是切换了元素的 visibility 属性|
|fn+f2 | 切换作为HTML编辑状态|


Style Panel:

|快捷键|功能|
| ------| ------ |
|tab键|逐一切换至当前选中属性名／属性值的下一个。shift＋tab是切换成上一个。|
|option＋向上／向下箭头|给当前选中的属性值加0.1或减0.1。|
|向上和向下箭头|给当前选中的属性值加1或减1。|
|shift＋向上／向下箭头|给给当前选中的属性值加10或减10。|
|command＋向上／向下箭头|给给当前选中的属性值加100或减100。|


Debugger Panel:

|快捷键|功能|
| ------| ------ |
|fn+f8 或者 command + \ |是中断或继续调试|
|fn+f10 |step over|
|command＋b |切换添加和取消当前断点|


Console Panel:

|快捷键|功能|
| ------| ------ |
|command + k 或者 control + l |用来清除控制台的原有的所有输出|
|ctrl + u |用来清除当前控制台输入的内容|


Timeline Panel:

|快捷键|功能|
| ------| ------ |
|command + e |开始和结果recording|
|command + r |record page reload|
|[ 和 ]  |跳到上一帧或下一帧|


Profiles Panel:

|快捷键|功能|
| ------| ------ |
|command + e 开始或结束recording|


All Panels:

|快捷键|功能|
| ------| ------ |
|command + [ 或者  command + ] | 切换到上一个或下一个面板|
|control + ~ |显示console|
|esc  |关闭底部的抽屉（drawer，主要是对应开发者工具条右上角关闭按钮左侧的三个点的按钮——》more tools菜单下的那些工具）|
|command+shift+m |切换是否要模拟设备的状态|
|command + f  |在当前文件中搜索|
|command + option + f  |在所有sources文件中搜索|
|command + g |查找下一个符合查找条件的内容|
|command + p  |直接打开某个source文件（go to source）|


### 关闭chrome的进程

Chrome浏览器右上角菜单（三个点菜单） > 更多工具 > 任务管理器 就可以看到运行中的Chrome的进程

选择按cpu从高到低排序就可以找出卡住的进程。可以选中它点结束进程将其关闭。

### 断点

- 添加条件断点

选中某一个行号，右键点击，选择Add Conditional Breakpoint可以添加条件断点（这里会让你设置断点条件），比如当断点条件为真的时候才进性断点。

- 断点后的变量保存到全局

选中变量, 右键 Evalute in console
在 console 中选中输出的内容, 右键 store as global variable

- 元素的事件上断点

devtools 可以查看某一个元素上绑定了哪些事件: Elements > Event Listeners

找到对应事件的handler， 右键点击它，选择Show Function Definition 可以定位到代码中定义该事件处理函数的位置，添加断点即可。这种断点方式一般都会断在类库里, 一般所有事件都通过一个函数代理, 要找到对应业务代码还得一步一步跟进进去, 比较麻烦; 对于这种情况, 可以通过 dom mutation 断点。

- dom mutation 断点

dom mutation event 是 DOM3 添加的新的事件, 一般是 dom 结构改变时触发.

elements面板中选中元素，右键单击，选择break on.. , 再选择 Subtree Modifications或者 Attribute Modifications 或者Node Removal 时断点。

对上面 元素上事件断点(mouseover) 后不容易找到业务代码, 使用 mutation 断点, 断点后配合 call stack 就可以找到业务代码了。

这种情况使用全局搜索(ctrl + shift + f) 代码中 css classname 也能找到业务代码, 然后直接断点也可以。

- 全局事件断点

devtools 还可以对事件发生时断点, 比如 click 发生时断点, 这个跟 元素上事件断点 不同, 不会限定在元素上, 只要是事件发生, 并且有 handler 就断点;
还可以对 resize, ajax, setTimeout/setInterval 断点.

再Sources面板下的draw（抽屉）中，展开Event Lisener Breakpoints，展开其中的某项够选中某事件即可实现全局事件断点（即对所有元素的该事件进行断点）。比如，勾选中Touch下的touchstart。







### console

- 没引jQuery也可以在console中用$('选择器')，实际上是`chrome对document.querySelector()`和`document.querySelectorAll()`进行了简单封装而得。

- $_ 可以引用到最近在console中使用过的一个表达式。

- $0、$1、$2、$3、$4用来引用你最近在ElementsHTML面板中选取过的5个DOM元素。
$0为ElementsHTML面板中选中的元素。$1 为上一次在 HTML 面板中选中的元素。其它的以此类推。

- copy

比如copy($0)

复制到剪切板，copy之后，直接ctrl+v

- 如果参数是格式字符串（使用了格式占位符），log方法将占位符替换以后的内容，显示在控制台窗口。

```
console.log(" %s + %s = %s", 1, 1, 2)  
//  输出为：  
//  1 + 1 = 2  
```

除了%s外，chrome console支持以下格式化字符：

%s，字符串
%d / %i，整数
%f，浮点数
%o，DOM元素
%O，JS对象
%c，CSS样式

- console.info、debug、warn、error

根据信息的不同性质，console对象还有4种显示信息的方法，分别是一般信息console.info()、出错信息console.debug()、警告提示console.warn()、错误提示console.error()。 和console.log的用法一样。

- console.dir

console.dir()可以显示一个对象包括子对象的属性以列表形式输出，可以用该方法快速概览对象的属性和方法。

- console.table

console.table 可将传入的对象，或数组以表格形式输出，相比传统树形输出，这种输出方案更适合内部元素排列整齐的对象或数组，不然可能会出现很多的 undefined。

- console.time 

查看一段代码执行了多长时间

```
console.time("耗时");  
var a = new Array();  
for(var i=0;i<10000;i++) a[i] = "a" + i;  
console.timeEnd("耗时");  
```

- console.profile

- console.assert

接收至少两个参数，第一个参数的值或返回值为false的时候，将会在控制台上输出后续参数的值并抛出AssertionError异常。例如：

```
console.assert(1 == 1, object); // 无输出  
console.assert(1 == 2, object); // 输出 object 并抛出AssertionError异常
```

- console.count

count 方法用于统计当前代码被执行过多少次，传入一个参数，可以在次数前面输出额外的标题以帮助阅读。

```
function a(){
    console.count('run');
};
for (var i = 0; i < 5; i++) {
    a();
}
//run: 1 
//run: 2 
//run: 3 
//run: 4 
//run: 5 
```

- console.trace

console.trace()用来追踪函数的调用轨迹。在大型项目尤其是框架开发中，函数的调用轨迹可以十分复杂，console.trace()方法可以将函数的被调用过程清楚地输出到控制台上。

```
function one(a) {
  console.trace();
  return a;
}

function two(a) {
  return three(a);
}

function three(a) {
  return one(a);
}

var a = two('tracer');
```

- console中如何换行？ Shift+Enter即可
















